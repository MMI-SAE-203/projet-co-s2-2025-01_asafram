---
import Logo from "../assets/icones/logo_asafram-fonce.svg";
import IconInstagram from "../assets/icones/instagram.svg";
import IconFacebook from "../assets/icones/facebook.svg";
import IconTikTok from "../assets/icones/tiktok.svg";
import IconeEnvoyer from "../assets/icones/icone-envoyer.webp";
import FondMenu from "../assets/fond/degrade-menu-mobile.svg";
import LigneMenu1 from "../assets/fond/line1-menu.svg";
import LigneMenu2 from "../assets/fond/line2-menu.svg";
import IconeCroix from "../assets/icones/icone-croix-menu.svg";
---

<header
  class="flex items-center justify-between px-4 gap-8 border-b-1 bg-white h-20 shadow-sm lg:fixed lg:inset-x-0 lg:top-0 lg:h-20 lg:gap-8 lg:items-center lg:justify-between lg:z-10 lg:px-12"
  role="banner"
>
  <a href="/" aria-label="Accueil ASAFRAM">
    <img class="w-8" src={Logo.src} alt="Logo ASAFRAM" />
  </a>
  <button
    id="menu-btn"
    class="group relative z-10 flex h-3 w-6 flex-col justify-between *:block *:ease *:h-0.5 *:w-full *:transform *:rounded-full *:bg-black *:transition *:duration-300 lg:hidden"
    aria-label="Menu de navigation"
    aria-controls="menu"
    aria-expanded="false"
  >
    <span
      class="group-aria-expanded:translate-y-[5px] group-aria-expanded:rotate-45"
    ></span>
    <span
      class="group-aria-expanded:-translate-y-[5px] group-aria-expanded:-rotate-45"
    ></span>
  </button>

  <nav
    id="menu"
    class="flex-1 px-6 py-12 flex mt-20 flex-col fixed z-10 inset-0 visible transition-transform duration-300 transform translate-x-full aria-expanded:translate-x-0 lg:hidden bg-background"
    aria-hidden="true"
    role="navigation"
    aria-label="Menu principal mobile"
  >
    <div class="absolute inset-0 w-full h-full z-0">
      <img
        src={FondMenu.src}
        alt="Fond de menu décoratif"
        class="w-full h-full object-cover"
      />
    </div>
    <div
      class="flex flex-col items-center justify-center h-full relative w-full"
    >
      <img
        src={LigneMenu1.src}
        alt=""
        aria-hidden="true"
        class="absolute top-[-36px] left-0 w-30 md:left-30 md:w-36 lg:w-48 z-0"
      />
      <ul
        class="flex flex-col gap-24 items-center justify-center text-center mb-4 z-10"
      >
        <li>
          <a class="uppercase text-xl font-bold" href="/mission"
            >Notre Mission</a
          >
        </li>
        <li>
          <a class="uppercase text-xl font-bold" href="/apropos"
            >Qui Sommes-nous ?</a
          >
        </li>
        <li>
          <a class="uppercase text-xl font-bold" href="/partenaires"
            >Devenir Partenaire</a
          >
        </li>
      </ul>
      <div class="mt-20">
        <a class="btn-landing-page text-white bg-black" href="">S'inscrire</a>
      </div>
      <ul class="mt-26 flex gap-20 items-center justify-center z-10">
        <li>
          <a href="" aria-label="Page Facebook ASAFRAM"
            ><img src={IconFacebook.src} alt="Facebook" /></a
          >
        </li>
        <li>
          <a href="" aria-label="Page Instagram ASAFRAM"
            ><img src={IconInstagram.src} alt="Instagram" /></a
          >
        </li>
        <li>
          <a href="" aria-label="Page TikTok ASAFRAM"
            ><img src={IconTikTok.src} alt="TikTok" /></a
          >
        </li>
      </ul>
      <img
        src={LigneMenu2.src}
        alt=""
        aria-hidden="true"
        class="absolute bottom-[-160px] right-4 w-20 md:w-24 md:right-50 md:bottom-[-220px] z-0"
      />
    </div>
  </nav>

  <nav
    class="hidden lg:flex lg:fixed lg:inset-x-0 lg:h-20 lg:px-12 lg:items-center lg:justify-between bg-white shadow-sm"
    role="navigation"
    aria-label="Menu principal desktop"
  >
    <div class="flex-none">
      <a href="/" aria-label="Accueil ASAFRAM">
        <img class="w-12" src={Logo.src} alt="Logo Asafram" />
      </a>
    </div>

    <ul class="flex flex-row gap-40 items-center justify-center flex-1">
      <li>
        <a href="/mission" class="font-bold xl:text-xl lg:text-lg"
          >Notre Mission</a
        >
      </li>
      <li>
        <a href="/apropos" class="font-bold xl:text-xl lg:text-lg"
          >Qui Sommes-nous ?</a
        >
      </li>
      <li>
        <a href="/partenaires" class="font-bold xl:text-xl lg:text-lg"
          >Devenir Partenaire</a
        >
      </li>
    </ul>

    <div class="flex-none">
      <a
        class="btn-landing-page flex items-center justify-center gap-4"
        href="/site-applicatif/auth/connexion"
        aria-label="S'inscrire à ASAFRAM"
      >
        <img class="w-6" src={IconeEnvoyer.src} alt="" aria-hidden="true" />
        <p>S'inscrire</p>
      </a>
    </div>
  </nav>
</header>

<script>
  // On cible les éléments à modifier
  const toggle = document.querySelector("#menu-btn");
  const nav = document.querySelector("#menu");
  const page = document.body;

  // Variable pour stocker la position de défilement initiale
  let scrollPosition = 0;

  // Fonction pour bloquer le défilement
  function disableScroll() {
    // Enregistrer la position de défilement actuelle
    scrollPosition = window.scrollY || document.documentElement.scrollTop || 0;

    // Ajouter plusieurs styles pour bloquer le défilement
    page.classList.add("noscroll");
    page.style.top = `-${scrollPosition}px`;
    page.style.position = "fixed";
    page.style.width = "100%";
    page.style.overflowY = "hidden";
  }

  // Fonction pour réactiver le défilement
  function enableScroll() {
    // Supprimer les styles de blocage
    page.classList.remove("noscroll");
    page.style.position = "";
    page.style.top = "";
    page.style.width = "";
    page.style.overflowY = "";

    // Restaurer la position de défilement
    window.scrollTo({
      top: scrollPosition,
      behavior: "instant",
    });
  }

  // Vérifier si les éléments existent avant d'ajouter l'événement
  if (toggle && nav) {
    toggle.addEventListener("click", () => {
      const isOpen = toggle.ariaExpanded === "true";
      const isClosed = !isOpen;

      // Mise à jour des attributs ARIA pour accessibilité
      toggle.ariaExpanded = String(isClosed);

      if (isClosed) {
        // Ouverture du menu
        nav.ariaHidden = "false";
        nav.ariaExpanded = "true";
        disableScroll();
      } else {
        // Fermeture du menu - on retarde la disparition
        nav.ariaExpanded = "false";
        enableScroll();

        // On attend que l'animation soit terminée avant de cacher le menu
        setTimeout(() => {
          if (toggle.ariaExpanded === "false") {
            nav.ariaHidden = "true";
          }
        }, 300); // Durée correspondant à duration-300
      }
    });
  }
</script>

<style>
  .noscroll {
    overflow: hidden !important;
    position: fixed;
    width: 100%;
    height: 100%;
    touch-action: none;
    -webkit-overflow-scrolling: none;
  }
</style>
