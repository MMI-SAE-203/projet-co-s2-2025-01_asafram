---
import LayoutApplicatif from "../../layouts/LayoutApplicatif.astro";
import CardProduits from "../../components/site-applicatif/CardProduits.astro";
import BulleCategorie from "../../components/site-applicatif/BulleCategorie.astro";
import { getProductsByContinent } from "../../../backend/backend.js";
import IconeBoissons from "../../assets/icones/icone-boissons.webp";
import IconeFruitsEtLegumes from "../../assets/icones/icone-fruits.webp";
import IconeViandes from "../../assets/icones/icone-viandes.webp";
import IconeEpices from "../../assets/icones/icone-epices.webp";
import IconeSnacks from "../../assets/icones/icone-snacks.webp";
import SvgAsie from "../../assets/icones/continent-asie.svg";
import SvgAfrique from "../../assets/icones/continent-afrique.svg";
import SvgAmeriqueLatine from "../../assets/icones/continent-ameriquelatine.svg";
import SvgMaghreb from "../../assets/icones/continent-maghreb.svg";

// Définition des catégories
const categories = [
  { nom: "Boissons", icone: IconeBoissons },
  { nom: "Fruits et Légumes", icone: IconeFruitsEtLegumes },
  { nom: "Viandes", icone: IconeViandes },
  { nom: "Épices", icone: IconeEpices },
  { nom: "Snacks", icone: IconeSnacks },
];

// Récupération des produits asiatiques
const asianProductsResult = await getProductsByContinent("Asie", {
  perPage: 8, // On récupère 8 produits maximum
});

// Ajout d'une distance fictive aux produits et extraction des items de la réponse
const asianProducts = asianProductsResult.items.map((produit) => {
  // Ajout d'une distance (valeur fictive)
  produit.distance = 15;

  // Correction pour le nombre de notes (si nombres_notes existe mais pas nbNotes)
  if (produit.nombres_notes && !produit.nbNotes) {
    produit.nbNotes = produit.nombres_notes;
  }

  // Si aucune note n'est définie, on ajoute une valeur par défaut
  if (!produit.nbNotes) {
    produit.nbNotes = Math.floor(Math.random() * 50) + 10; // Entre 10 et 59 notes aléatoirement
  }

  return produit;
});
---

<LayoutApplicatif title="ASAFRAM" description="Carte produit démo">
  <!-- Section des catégories -->
  <section class="container mx-auto px-4 py-8">
    <ul class="flex flex-wrap justify-center gap-32 my-8">
      {
        categories.map((categorie) => (
          <li>
            <BulleCategorie nom={categorie.nom} icone={categorie.icone.src} />
          </li>
        ))
      }
    </ul>
  </section>

  <!-- Section des produits asiatiques -->
  <section class="container mx-auto px-4 py-8">
    <header class="mb-8">
      <h2
        class="text-2xl !text-left font-raleway font-extrabold uppercase tracking-wider relative inline-block"
      >
        Produits Asiatiques
      </h2>
      <div class="w-full h-0.5 bg-saumon mt-2"></div>
    </header>

    <div
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 justify-items-center"
    >
      {asianProducts.map((produit) => <CardProduits product={produit} />)}
    </div>

    <div class="flex justify-center mt-10">
      <a
        class="bg-saumon text-black font-bold uppercase py-3 px-8 rounded-full hover:bg-[#e69c50] transition-colors duration-300"
      >
        Tout afficher
      </a>
    </div>
  </section>
</LayoutApplicatif>
