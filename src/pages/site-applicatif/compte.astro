---
import LayoutApplicatif from "../../layouts/LayoutApplicatif.astro";
import {
  getCurrentUser,
  logoutUser,
  updateUserProfile,
  uploadUserAvatar,
} from "../../../backend/backend.js";
import SvgAsie from "../../assets/icones/continent-asie.svg";
import SvgAfrique from "../../assets/icones/continent-afrique.svg";
import SvgAmeriqueLatine from "../../assets/icones/continent-ameriquelatine.svg";
import SvgMaghreb from "../../assets/icones/continent-maghreb.svg";
import IconeUser from "../../assets/icones/icone-user.svg";

const user = await getCurrentUser();

if (!user) {
  return Astro.redirect("/site-applicatif/auth/connexion");
}

if (Astro.request.method === "POST") {
  const formData = await Astro.request.formData();
  const action = formData.get("action");

  if (action === "logout") {
    await logoutUser();
    return Astro.redirect("/site-applicatif/auth/connexion");
  }

  if (action === "updateProfile") {
    try {
      const userData = {
        name: formData.get("name")?.toString() || user.name,
        nom: formData.get("nom")?.toString() || user.nom || "",
        prenom: formData.get("prenom")?.toString() || user.prenom || "",
        username: formData.get("username")?.toString() || user.username || "",
        email: formData.get("email")?.toString() || user.email,
        bio: formData.get("bio")?.toString() || user.bio || "",
        allergies:
          formData.get("allergies")?.toString() || user.allergies || "",
        pays_origine:
          formData.get("pays_origine")?.toString() || user.pays_origine || "",
      };

      await updateUserProfile(userData);

      const avatarFile = formData.get("avatar");
      if (avatarFile instanceof File && avatarFile.size > 0) {
        await uploadUserAvatar(avatarFile);
      }

      return Astro.redirect("/site-applicatif/compte?updated=true");
    } catch (error) {
      console.error("Erreur lors de la mise à jour du profil:", error);
    }
  }
}

const pays = [
  { code: "FR", nom: "France" },
  { code: "MA", nom: "Maroc" },
  { code: "DZ", nom: "Algérie" },
  { code: "TN", nom: "Tunisie" },
  { code: "CN", nom: "Chine" },
  { code: "JP", nom: "Japon" },
  { code: "KR", nom: "Corée du Sud" },
  { code: "VN", nom: "Vietnam" },
  { code: "TH", nom: "Thaïlande" },
  { code: "SN", nom: "Sénégal" },
  { code: "CI", nom: "Côte d'Ivoire" },
  { code: "MX", nom: "Mexique" },
  { code: "BR", nom: "Brésil" },
  { code: "PE", nom: "Pérou" },
  { code: "IN", nom: "Inde" },
];
---

<LayoutApplicatif
  title={`Profil de ${user.name || user.username}`}
  description="Gérez votre profil ASAFRAM, modifiez vos informations personnelles et vos préférences."
>
  <div class="min-h-screen bg-gray-50">
    <div
      class="relative bg-gradient-to-r from-background to-background/70 py-8 mb-8 overflow-hidden"
    >
      <div class="absolute inset-0 overflow-hidden opacity-20">
        <div class="absolute inset-0 z-0">
          <img
            src={SvgAsie.src}
            alt=""
            class="absolute w-[30%] max-w-none h-auto top-[-10%] left-[5%] continent-float"
            style="animation-delay: 0s"
            aria-hidden="true"
          />
          <img
            src={SvgAfrique.src}
            alt=""
            class="absolute w-[30%] max-w-none h-auto bottom-[-20%] right-[5%] continent-float"
            style="animation-delay: 1.5s"
            aria-hidden="true"
          />
          <img
            src={SvgAmeriqueLatine.src}
            alt=""
            class="absolute w-[25%] max-w-none h-auto top-[40%] left-[65%] continent-float"
            style="animation-delay: 2.5s"
            aria-hidden="true"
          />
          <img
            src={SvgMaghreb.src}
            alt=""
            class="absolute w-[20%] max-w-none h-auto top-[10%] right-[20%] continent-float"
            style="animation-delay: 0.8s"
            aria-hidden="true"
          />
        </div>
      </div>

      <div class="container mx-auto px-4 relative z-10">
        <h1 class="!text-7xl font-bold text-black mb-2">Mon Compte</h1>
      </div>
    </div>

    <div class="container mx-auto px-4 pb-16">
      <div class="flex flex-col lg:flex-row gap-8">
        <aside class="lg:w-1/4">
          <div class="bg-white rounded-xl shadow-md overflow-hidden">
            <div
              class="p-6 bg-gradient-to-r from-background/20 to-background/30 border-b border-gray-200"
            >
              <div class="flex items-center gap-4">
                <div class="relative">
                  <div
                    class="w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden border-2 border-white shadow-md"
                  >
                    {
                      user.avatarUrl ? (
                        <img
                          src={user.avatarUrl}
                          alt={user.name || user.username}
                          class="w-full h-full object-cover"
                        />
                      ) : (
                        <img
                          src={IconeUser.src}
                          alt="Profil"
                          class="w-12 h-12 opacity-60"
                        />
                      )
                    }
                  </div>
                </div>
                <div>
                  <h2 class="text-xl font-semibold text-gray-800">
                    {user.name || user.username}
                  </h2>
                  <p class="text-gray-600 text-sm">
                    Membre depuis {
                      new Date(user.created).toLocaleDateString("fr-FR", {
                        year: "numeric",
                        month: "long",
                      })
                    }
                  </p>
                </div>
              </div>
            </div>

            <nav>
              <ul class="py-2">
                <li>
                  <button
                    class="w-full px-6 py-3 flex items-center gap-3 text-left hover:bg-gray-50 text-saumon font-medium"
                    data-tab="profile"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                        clip-rule="evenodd"></path>
                    </svg>
                    <span>Mon profil</span>
                  </button>
                </li>
                <li>
                  <button
                    class="w-full px-6 py-3 flex items-center gap-3 text-left hover:bg-gray-50 text-gray-600"
                    data-tab="favorites"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path
                        d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                      ></path>
                    </svg>
                    <span>Mes favoris</span>
                  </button>
                </li>
                <li>
                  <button
                    class="w-full px-6 py-3 flex items-center gap-3 text-left hover:bg-gray-50 text-gray-600"
                    data-tab="reviews"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z"
                        clip-rule="evenodd"></path>
                    </svg>
                    <span>Mes avis</span>
                  </button>
                </li>
                <li>
                  <button
                    class="w-full px-6 py-3 flex items-center gap-3 text-left hover:bg-gray-50 text-gray-600"
                    data-tab="parameters"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z"
                        clip-rule="evenodd"></path>
                    </svg>
                    <span>Paramètres</span>
                  </button>
                </li>
                <li class="mt-3 border-t border-gray-200">
                  <form method="POST">
                    <input type="hidden" name="action" value="logout" />
                    <button
                      type="submit"
                      class="w-full px-6 py-3 flex items-center gap-3 text-left hover:bg-gray-50 text-red-500"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M3 3a1 1 0 00-1 1v12a1 1 0 001 1h12a1 1 0 001-1V7.414l-5-5L3 3zm7 2.586L13.586 9H10v2h3.586L10 14.586V12H8v5h9V5h-7v.586z"
                          clip-rule="evenodd"></path>
                      </svg>
                      <span>Se déconnecter</span>
                    </button>
                  </form>
                </li>
              </ul>
            </nav>
          </div>
        </aside>

        <main class="lg:w-3/4">
          {
            Astro.url.searchParams.get("updated") && (
              <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-6 rounded-md animate-fadeIn">
                <div class="flex items-center">
                  <div class="flex-shrink-0">
                    <svg
                      class="h-5 w-5 text-green-400"
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                        clip-rule="evenodd"
                      />
                    </svg>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm font-medium text-green-800">
                      Profil mis à jour avec succès !
                    </p>
                  </div>
                </div>
              </div>
            )
          }

          <div class="bg-white rounded-xl shadow-md overflow-hidden">
            <div id="profile-tab" class="tab-content">
              <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                  <h2 class="text-2xl font-bold text-gray-800">
                    Informations personnelles
                  </h2>
                </div>

                <form
                  method="POST"
                  enctype="multipart/form-data"
                  class="space-y-6"
                >
                  <input type="hidden" name="action" value="updateProfile" />

                  <!-- Avatar -->
                  <div class="mb-8">
                    <label class="block text-sm font-medium text-gray-700 mb-2"
                      >Photo de profil</label
                    >
                    <div class="flex items-center gap-6">
                      <div class="relative">
                        <div
                          class="w-24 h-24 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden border-2 border-white shadow-md"
                        >
                          {
                            user.avatarUrl ? (
                              <img
                                src={user.avatarUrl}
                                alt={user.name || user.username}
                                class="w-full h-full object-cover"
                                id="avatar-preview"
                              />
                            ) : (
                              <img
                                src={IconeUser.src}
                                alt="Profil"
                                class="w-14 h-14 opacity-60"
                                id="avatar-preview-placeholder"
                              />
                            )
                          }
                        </div>
                        <div
                          class="absolute bottom-0 right-0 bg-saumon rounded-full p-1.5 shadow-md border border-white"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4 text-white"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                          >
                            <path
                              d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"
                            ></path>
                          </svg>
                        </div>
                      </div>
                      <div>
                        <div class="flex items-center">
                          <input
                            type="file"
                            name="avatar"
                            id="avatar"
                            accept="image/*"
                            class="hidden"
                          />
                          <label
                            for="avatar"
                            class="cursor-pointer bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none"
                          >
                            Changer la photo
                          </label>
                          <button
                            type="button"
                            id="remove-avatar"
                            class="ml-3 text-sm text-gray-500 hover:text-gray-700"
                          >
                            Supprimer
                          </button>
                        </div>
                        <p class="mt-1 text-xs text-gray-500">
                          JPG ou PNG. 1 Mo maximum.
                        </p>
                      </div>
                    </div>
                  </div>

                  <!-- Informations générales -->
                  <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                    <div>
                      <label
                        for="username"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >Nom d'utilisateur</label
                      >
                      <input
                        type="text"
                        name="username"
                        id="username"
                        value={user.username || ""}
                        class="w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-saumon focus:border-saumon"
                        placeholder="Votre nom d'utilisateur"
                      />
                    </div>

                    <div>
                      <label
                        for="email"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >Email</label
                      >
                      <input
                        type="email"
                        name="email"
                        id="email"
                        value={user.email || ""}
                        class="w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-saumon focus:border-saumon"
                        placeholder="vous@exemple.com"
                      />
                    </div>

                    <div>
                      <label
                        for="nom"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >Nom</label
                      >
                      <input
                        type="text"
                        name="nom"
                        id="nom"
                        value={user.nom || ""}
                        class="w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-saumon focus:border-saumon"
                        placeholder="Votre nom"
                      />
                    </div>

                    <div>
                      <label
                        for="prenom"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >Prénom</label
                      >
                      <input
                        type="text"
                        name="prenom"
                        id="prenom"
                        value={user.prenom || ""}
                        class="w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-saumon focus:border-saumon"
                        placeholder="Votre prénom"
                      />
                    </div>

                    <div class="sm:col-span-2">
                      <label
                        for="pays_origine"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >Pays d'origine</label
                      >
                      <select
                        name="pays_origine"
                        id="pays_origine"
                        class="w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-saumon focus:border-saumon"
                      >
                        <option value="">Sélectionnez un pays</option>
                        {
                          pays.map((p) => (
                            <option
                              value={p.code}
                              selected={user.pays_origine === p.code}
                            >
                              {p.nom}
                            </option>
                          ))
                        }
                      </select>
                    </div>

                    <div class="sm:col-span-2">
                      <label
                        for="allergies"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >Allergies</label
                      >
                      <input
                        type="text"
                        name="allergies"
                        id="allergies"
                        value={user.allergies || ""}
                        class="w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-saumon focus:border-saumon"
                        placeholder="Vos allergies alimentaires (séparées par des virgules)"
                      />
                    </div>

                    <div class="sm:col-span-2">
                      <label
                        for="bio"
                        class="block text-sm font-medium text-gray-700 mb-1"
                        >Biographie</label
                      >
                      <textarea
                        name="bio"
                        id="bio"
                        rows="4"
                        class="w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-saumon focus:border-saumon"
                        placeholder="Parlez-nous un peu de vous et de vos intérêts culinaires..."
                        >{user.bio || ""}</textarea
                      >
                    </div>
                  </div>

                  <div class="flex justify-end pt-4">
                    <button
                      type="submit"
                      class="bg-saumon hover:bg-saumon/90 text-white font-medium py-2 px-6 rounded-lg shadow-sm transition-all duration-300 transform hover:-translate-y-1 hover:shadow-md flex items-center gap-2"
                    >
                      <span>Enregistrer les modifications</span>
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                          clip-rule="evenodd"></path>
                      </svg>
                    </button>
                  </div>
                </form>
              </div>
            </div>

            <!-- Onglet Favoris -->
            <div id="favorites-tab" class="tab-content hidden">
              <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                  <h2 class="text-2xl font-bold text-gray-800">
                    Mes produits favoris
                  </h2>
                </div>

                <!-- Filtres de favoris -->
                <div class="mb-6">
                  <div class="flex space-x-2">
                    <button class="px-4 py-2 bg-saumon text-white rounded-md"
                      >Tous</button
                    >
                    <button
                      class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50"
                      >Produits</button
                    >
                    <button
                      class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50"
                      >Recettes</button
                    >
                    <button
                      class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50"
                      >Boutiques</button
                    >
                  </div>
                </div>

                <!-- Message si aucun favori -->
                <div
                  class="text-center py-12 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="mx-auto h-12 w-12 text-gray-400"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                    ></path>
                  </svg>
                  <h3 class="mt-2 text-sm font-medium text-gray-900">
                    Aucun favori
                  </h3>
                  <p class="mt-1 text-sm text-gray-500">
                    Commencez à ajouter des produits à vos favoris pour les
                    retrouver ici.
                  </p>
                  <div class="mt-6">
                    <a
                      href="/site-applicatif/produits"
                      class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-saumon hover:bg-saumon/90"
                    >
                      <svg
                        class="-ml-1 mr-2 h-5 w-5"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        aria-hidden="true"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                          clip-rule="evenodd"></path>
                      </svg>
                      Découvrir des produits
                    </a>
                  </div>
                </div>

                <!-- Liste des favoris (cachée par défaut) -->
                <div
                  class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-6"
                >
                  <!-- Carte favori (exemple) -->
                  <div
                    class="bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow"
                  >
                    <div class="relative h-48 bg-gray-200">
                      <img
                        src="https://via.placeholder.com/300x200"
                        alt="Produit"
                        class="w-full h-full object-cover"
                      />
                      <button
                        class="absolute top-2 right-2 p-1.5 bg-white rounded-full shadow-md hover:bg-red-50"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-5 w-5 text-red-500"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"
                            clip-rule="evenodd"></path>
                        </svg>
                      </button>
                    </div>
                    <div class="p-4">
                      <div class="flex justify-between items-start">
                        <h3 class="text-lg font-medium text-gray-900">
                          Nom du produit
                        </h3>
                        <span
                          class="bg-saumon/10 text-saumon px-2 py-1 rounded text-xs font-medium"
                          >Produit</span
                        >
                      </div>
                      <p class="mt-1 text-sm text-gray-500 line-clamp-2">
                        Description du produit qui peut s'étendre sur plusieurs
                        lignes...
                      </p>
                      <div class="mt-4 flex justify-between items-center">
                        <div class="flex items-center">
                          <img
                            src="https://flagcdn.com/w20/fr.png"
                            alt="Drapeau"
                            class="w-5 h-auto mr-1.5"
                          />
                          <span class="text-sm text-gray-700">France</span>
                        </div>
                        <a
                          href="#"
                          class="text-sm font-medium text-saumon hover:text-saumon/80"
                        >
                          Voir détails →
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Onglet Avis -->
            <div id="reviews-tab" class="tab-content hidden">
              <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                  <h2 class="text-2xl font-bold text-gray-800">Mes avis</h2>
                </div>

                <!-- Message si aucun avis -->
                <div
                  class="text-center py-12 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="mx-auto h-12 w-12 text-gray-400"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                    ></path>
                  </svg>
                  <h3 class="mt-2 text-sm font-medium text-gray-900">
                    Vous n'avez pas encore laissé d'avis
                  </h3>
                  <p class="mt-1 text-sm text-gray-500">
                    Partagez votre expérience sur les produits, recettes et
                    boutiques.
                  </p>
                  <div class="mt-6">
                    <a
                      href="/site-applicatif/produits"
                      class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-saumon hover:bg-saumon/90"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="-ml-1 mr-2 h-5 w-5"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
                          clip-rule="evenodd"></path>
                      </svg>
                      Explorer les produits
                    </a>
                  </div>
                </div>

                <!-- Liste des avis (cachée par défaut) -->
                <div class="hidden space-y-6 mt-6">
                  <!-- Avis exemple -->
                  <div
                    class="bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow p-5"
                  >
                    <div class="flex justify-between">
                      <div class="flex items-center gap-3">
                        <div class="flex items-center">
                          <span class="text-lg font-medium mr-2">4.5</span>
                          <div class="flex">
                            {
                              Array(5)
                                .fill(0)
                                .map((_, i) => (
                                  <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class={`h-5 w-5 ${i < 4 ? "text-yellow-400" : "text-gray-300"}`}
                                    viewBox="0 0 20 20"
                                    fill="currentColor"
                                  >
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                  </svg>
                                ))
                            }
                          </div>
                        </div>
                        <span
                          class="bg-saumon/10 text-saumon px-2 py-1 rounded text-xs font-medium"
                          >Produit</span
                        >
                      </div>
                      <div class="text-sm text-gray-500">15 mai 2023</div>
                    </div>

                    <h3 class="text-lg font-medium text-gray-900 mt-3">
                      Sauce soja premium
                    </h3>
                    <p class="mt-2 text-gray-600">
                      Excellente sauce soja, le goût est authentique et
                      l'emballage est de qualité. Je recommande vivement ce
                      produit à tous les amateurs de cuisine asiatique !
                    </p>

                    <div class="mt-4 flex justify-between items-center">
                      <a
                        href="#"
                        class="text-sm font-medium text-saumon hover:text-saumon/80"
                      >
                        Voir le produit →
                      </a>
                      <div class="flex space-x-2">
                        <button
                          class="text-sm text-gray-500 hover:text-gray-700 flex items-center gap-1"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                          >
                            <path
                              d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"
                            ></path>
                          </svg>
                          Modifier
                        </button>
                        <button
                          class="text-sm text-red-500 hover:text-red-700 flex items-center gap-1"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                              clip-rule="evenodd"></path>
                          </svg>
                          Supprimer
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Onglet Paramètres -->
            <div id="parameters-tab" class="tab-content hidden">
              <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                  <h2 class="text-2xl font-bold text-gray-800">
                    Paramètres du compte
                  </h2>
                </div>

                <div class="space-y-8">
                  <!-- Préférences de notification -->
                  <div class="bg-white rounded-lg p-5 border border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">
                      Préférences de notification
                    </h3>

                    <div class="space-y-4">
                      <div class="flex items-center justify-between">
                        <div>
                          <h4 class="text-sm font-medium text-gray-700">
                            Newsletters
                          </h4>
                          <p class="text-sm text-gray-500">
                            Recevoir nos newsletters mensuelles avec nos
                            nouveautés
                          </p>
                        </div>
                        <label
                          class="relative inline-flex items-center cursor-pointer"
                        >
                          <input
                            type="checkbox"
                            value=""
                            class="sr-only peer"
                            checked
                          />
                          <div
                            class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-saumon/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-saumon"
                          >
                          </div>
                        </label>
                      </div>

                      <div class="flex items-center justify-between">
                        <div>
                          <h4 class="text-sm font-medium text-gray-700">
                            Nouveaux produits
                          </h4>
                          <p class="text-sm text-gray-500">
                            Être informé quand de nouveaux produits sont ajoutés
                          </p>
                        </div>
                        <label
                          class="relative inline-flex items-center cursor-pointer"
                        >
                          <input
                            type="checkbox"
                            value=""
                            class="sr-only peer"
                          />
                          <div
                            class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-saumon/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-saumon"
                          >
                          </div>
                        </label>
                      </div>

                      <div class="flex items-center justify-between">
                        <div>
                          <h4 class="text-sm font-medium text-gray-700">
                            Promotions et offres
                          </h4>
                          <p class="text-sm text-gray-500">
                            Recevoir des notifications sur les offres spéciales
                          </p>
                        </div>
                        <label
                          class="relative inline-flex items-center cursor-pointer"
                        >
                          <input
                            type="checkbox"
                            value=""
                            class="sr-only peer"
                            checked
                          />
                          <div
                            class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-saumon/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-saumon"
                          >
                          </div>
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- Sécurité -->
                  <div class="bg-white rounded-lg p-5 border border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">
                      Sécurité
                    </h3>

                    <div class="space-y-6">
                      <div>
                        <h4 class="text-sm font-medium text-gray-700 mb-1">
                          Changer le mot de passe
                        </h4>
                        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                          <div>
                            <label for="current-password" class="sr-only"
                              >Mot de passe actuel</label
                            >
                            <input
                              type="password"
                              name="current-password"
                              id="current-password"
                              class="w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-saumon focus:border-saumon"
                              placeholder="Mot de passe actuel"
                            />
                          </div>
                          <div>
                            <label for="new-password" class="sr-only"
                              >Nouveau mot de passe</label
                            >
                            <input
                              type="password"
                              name="new-password"
                              id="new-password"
                              class="w-full px-4 py-2 rounded-md border border-gray-300 focus:ring-2 focus:ring-saumon focus:border-saumon"
                              placeholder="Nouveau mot de passe"
                            />
                          </div>
                        </div>
                        <button
                          type="button"
                          class="mt-4 bg-saumon hover:bg-saumon/90 text-white font-medium py-2 px-4 rounded-md shadow-sm"
                        >
                          Mettre à jour le mot de passe
                        </button>
                      </div>

                      <div class="pt-2">
                        <h4 class="text-sm font-medium text-gray-700 mb-1">
                          Sessions actives
                        </h4>
                        <div class="bg-gray-50 p-4 rounded-md">
                          <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                              <div class="p-2 bg-green-100 rounded-md">
                                <svg
                                  xmlns="http://www.w3.org/2000/svg"
                                  class="h-5 w-5 text-green-600"
                                  viewBox="0 0 20 20"
                                  fill="currentColor"
                                >
                                  <path
                                    fill-rule="evenodd"
                                    d="M10 2a8 8 0 100 16 8 8 0 000-16zm0 14a6 6 0 110-12 6 6 0 010 12z"
                                    clip-rule="evenodd"></path>
                                </svg>
                              </div>
                              <div>
                                <p class="text-sm font-medium text-gray-800">
                                  Session actuelle
                                </p>
                                <p class="text-xs text-gray-500">
                                  Paris, France • Chrome sur Windows
                                </p>
                              </div>
                            </div>
                            <span class="text-xs text-green-600 font-medium"
                              >Actif maintenant</span
                            >
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Zone de danger -->
                  <div class="bg-white rounded-lg p-5 border border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">
                      Zone de danger
                    </h3>

                    <div class="bg-red-50 p-4 rounded-md">
                      <div class="flex">
                        <div class="flex-shrink-0">
                          <svg
                            class="h-5 w-5 text-red-400"
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                              clip-rule="evenodd"></path>
                          </svg>
                        </div>
                        <div class="ml-3">
                          <h3 class="text-sm font-medium text-red-800">
                            Désactiver votre compte
                          </h3>
                          <div class="mt-2 text-sm text-red-700">
                            <p>
                              La désactivation de votre compte entraînera la
                              perte de votre profil, de vos favoris et de vos
                              avis. Cette action est définitive.
                            </p>
                          </div>
                          <div class="mt-4">
                            <button
                              type="button"
                              class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
                            >
                              Désactiver le compte
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
  </div>
</LayoutApplicatif>

<script>
  // Gestion des onglets
  document.addEventListener("DOMContentLoaded", () => {
    // Récupération des éléments
    const tabButtons = document.querySelectorAll("[data-tab]");
    const tabContents = document.querySelectorAll(".tab-content");

    // Fonction pour activer un onglet
    const activateTab = (tabId: string) => {
      // Cache tous les contenus d'onglets
      tabContents.forEach((content) => {
        content.classList.add("hidden");
      });

      // Réinitialise le style de tous les boutons
      tabButtons.forEach((btn) => {
        btn.classList.remove("text-saumon", "font-medium");
        btn.classList.add("text-gray-600");
      });

      // Affiche le contenu de l'onglet sélectionné
      const targetTab = document.getElementById(`${tabId}-tab`);
      if (targetTab) {
        targetTab.classList.remove("hidden");
      }

      // Met en évidence le bouton sélectionné
      const activeButton = document.querySelector(`[data-tab="${tabId}"]`);
      if (activeButton) {
        activeButton.classList.remove("text-gray-600");
        activeButton.classList.add("text-saumon", "font-medium");
      }
    };

    // Associe les événements de clic aux boutons
    tabButtons.forEach((button) => {
      button.addEventListener("click", () => {
        const tabId = button.getAttribute("data-tab") || "profile";
        activateTab(tabId);
      });
    });

    // Active l'onglet 'profile' par défaut
    activateTab("profile");
  });

  // Gestion de l'upload d'avatar
  document.addEventListener("DOMContentLoaded", () => {
    const avatarInput = document.getElementById("avatar") as HTMLInputElement;
    const avatarPreview = document.getElementById(
      "avatar-preview"
    ) as HTMLImageElement;
    const placeholderPreview = document.getElementById(
      "avatar-preview-placeholder"
    ) as HTMLImageElement;
    const removeAvatarBtn = document.getElementById(
      "remove-avatar"
    ) as HTMLButtonElement;

    if (
      avatarInput &&
      (avatarPreview || placeholderPreview) &&
      removeAvatarBtn
    ) {
      // Prévisualisation de l'image uploadée
      avatarInput.addEventListener("change", function () {
        if (this.files && this.files[0]) {
          const reader = new FileReader();

          reader.onload = function (e) {
            if (avatarPreview && e.target) {
              avatarPreview.src = e.target.result as string;
              avatarPreview.classList.remove("hidden");
            }

            if (placeholderPreview) {
              placeholderPreview.classList.add("hidden");
            }
          };

          reader.readAsDataURL(this.files[0]);
        }
      });

      // Suppression de l'avatar
      removeAvatarBtn.addEventListener("click", function () {
        if (avatarInput) {
          avatarInput.value = "";
        }

        if (avatarPreview) {
          avatarPreview.classList.add("hidden");
        }

        if (placeholderPreview) {
          placeholderPreview.classList.remove("hidden");
        }

        // Ajout d'un champ caché pour indiquer la suppression de l'avatar
        const removeAvatarInput = document.createElement("input");
        removeAvatarInput.type = "hidden";
        removeAvatarInput.name = "remove_avatar";
        removeAvatarInput.value = "true";

        // Recherche de l'ancien champ s'il existe et le remplace
        const existingInput = document.querySelector(
          'input[name="remove_avatar"]'
        );
        if (existingInput && existingInput.parentNode) {
          existingInput.parentNode.replaceChild(
            removeAvatarInput,
            existingInput
          );
        } else {
          // Sinon, ajoute le nouveau champ au formulaire
          const form = document.querySelector("form");
          if (form) {
            form.appendChild(removeAvatarInput);
          }
        }
      });
    }
  });
</script>
